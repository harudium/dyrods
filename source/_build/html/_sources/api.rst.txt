API 규격
=======================================

.. rst-class:: table-width-fix

.. _message_formats:

**Endpoint**

- RUUT 교통 정보 : `/ruut/version/segments`
- RUUT 이벤트 정보 : `/ruut/version/incidents`
- RUUT TPEG : `/ruut/version/tpeg`

Geo Filtering
--------------------------

지도 상의 영역을 지정하고 해당 영역 내에 포함되는 데이터만 추출하는 데 사용합니다. 인증, V2X를 제외한 모든 RUUT 플랫폼 기능의 필수 파라미터 입니다. Geo Filtering 은 총 5개 종류가 제공되며 각각의 필터 타입을 규정하기 위한 파라미터를 병용 하여야 합니다. 

Geo Filtering 파라미터 리스트
''''''''''''''''''''''''''

5개의 필터는 `filter-type` 파라미터의 값 영역에 명시하여 활성화 할 수 있습니다. 각각의 필터는 동시 사용이 불가합니다. 또한, 해당 필터와 병용 되어야 하는 파라미터가 추가로 명시되지 않을 경우 필터가 정상 동작하지 않습니다.

.. note:: 예) `/endpoint?filter-type=box&corner1={gps}&corner2={gps}` *`box` should be combined with `corner1` and `corner2`

+-------------+---------+-----------------+--------------------------------------------------------+
| Params      | Type    | Value           | Description                                            |
+=============+=========+=================+========================================================+
| filter-type | String  | box             | box shaped filter with 2 gps coordinates               |
+             +         +-----------------+--------------------------------------------------------+
|             |         | circle          | circle shaped filter with a centerpoint and a radius   |
+             +         +-----------------+--------------------------------------------------------+
|             |         | polygon         | polygon shaped filter with 3+ gps coordinates          |
+             +         +-----------------+--------------------------------------------------------+
|             |         | pos             | get the closest data from the position                 |
+             +         +-----------------+--------------------------------------------------------+
|             |         | centerpoint-box | box shaped filter with 1 center, width, height         |
+-------------+---------+-----------------+--------------------------------------------------------+
| corner1     | String  | gps             | diagonal point 1 of the 'box' filter                   |
+-------------+---------+-----------------+--------------------------------------------------------+
| corner2     | String  | gps             | diagonal point 2 of the 'box' filter                   |
+-------------+---------+-----------------+--------------------------------------------------------+
| center      | String  | gps             | centerpoint of the `circle` or `centerpoint-box` filter|
+-------------+---------+-----------------+--------------------------------------------------------+
| radius      | Integer | radius          | radius(km) of the `circle` filter                      |
+-------------+---------+-----------------+--------------------------------------------------------+
| height      | Integer | box height      | height (km) of the `centerpoint-box` filter            |
+-------------+---------+-----------------+--------------------------------------------------------+
| width       | Integer | box width       | width (km) of the `centerpoint-box` filter             |
+-------------+---------+-----------------+--------------------------------------------------------+
| points      | String  | gps             | A pipe-delimeted list of gps coordinates of\\          |
|             |         |                 | `polygon` filter. Max 8 coordinates are allowed        |
+-------------+---------+-----------------+--------------------------------------------------------+
| point       | String  | gps             | gps point to get the closest one by the `pos` filter   |
+-------------+---------+-----------------+--------------------------------------------------------+
| regionid    | Integer | region ID       | region ID to filter by administrative area             |
+-------------+---------+-----------------+--------------------------------------------------------+

Geo Filtering 예제 
''''''''''''''''''''''''''
+-----------------+---------+----------------------------------------------------------------------+
| Filter          | Method  | URL Sample                                                           |
+=================+=========+======================================================================+
| box             | **GET** | `/endpoint?filter-type=box&corner1={gps}&corner2={gps}`              |
+-----------------+---------+----------------------------------------------------------------------+
| circle          | **GET** | `/endpoint?filter-type=circle&center={gps}&radius={km}`              |
+-----------------+---------+----------------------------------------------------------------------+
| polygon         | **GET** | `/endpoint?filter-type=polygon&points={gps}|{gps}|{gps}|...`         |
+-----------------+---------+----------------------------------------------------------------------+
| pos             | **GET** | `/endpoint?filter-type=pos&point={gps}`                              |
+-----------------+---------+----------------------------------------------------------------------+
| centerpoint-box | **GET** | `/endpoint?filter-type=centerpoint-box&center={gps}&height={km}`\\   |
|                 |         | `&length={km}`                                                       | 
+-----------------+---------+----------------------------------------------------------------------+


RUUT
--------------------------
Segment
''''''''''''''''''''''''''

**Request**

+------------+-------------------------------------------------------------------------------------+
| **GET**    | `/ruut/{version}/segments?{geo-query}?{set of parameters}`                          |
+------------+-------------------------------------------------------------------------------------+

Request Parameters
..........................

=============  =========  =================  ========================================================
Params           Type         Value              Description
=============  =========  =================  ========================================================
rttiField       String        speed          현재 측정 속도 반환
-------------  ---------  -----------------  --------------------------------------------------------
\                \           limit           세그먼트 제한 속도 반환 
-------------  ---------  -----------------  --------------------------------------------------------
\                \           travletime      세그먼트 횡단 평균 시간 반환
-------------  ---------  -----------------  --------------------------------------------------------
\                \           freeflow        정체 없을 시 속도 반환
-------------  ---------  -----------------  --------------------------------------------------------
\                \           all(default)    모든 필드 반환
-------------  ---------  -----------------  --------------------------------------------------------
frc             Integer     frc              FRC 등급이 같은 항목만 반환 (쉼표 나누어 여러 개의 등급 명시 가능)
-------------  ---------  -----------------  --------------------------------------------------------
\                \          all(default)     모든 FRC 등급 데이터 반환
-------------  ---------  -----------------  --------------------------------------------------------
start-time      Datetime    yyyymmddhhss     해당 시점 데이터 반환하며 시점에 따라 3가지 패턴으로 구분

                                             - 현재
                                             - 과거
                                             - 미래
-------------  ---------  -----------------  --------------------------------------------------------
duration        Integer    5 - 60            start-time 부터 duration 까지의 데이터 반환. 예측 데이터의 
                                             경우 현재 시간 대비 1시간 까지만 반환 가능 
-------------  ---------  -----------------  --------------------------------------------------------
interval        Integer    분                 과거/미래 데이터 요청 시 매 `interval` 마다 데이터 추출
-------------  ---------  -----------------  --------------------------------------------------------
lane            String     on (default)      차선 단위 교통 정보 활성화
\                 \        off               차선 단위 교통 정보 비활성화
-------------  ---------  -----------------  --------------------------------------------------------
lr              String     openlr            위치 참조 정보로 openLR 인코딩 정보 반환
\                 \        agorac            위치 참조 정보로 AGORA-C 인코딩 정보 반환
\                 \        all (default)     위치 참조 정보로 openLR / AGORA-C 인코딩 정보 반환
-------------  ---------  -----------------  --------------------------------------------------------
coordinates     String     on (default)      제공 세그먼트의 시작/끝 노드의 GPS 좌표 정보 반환
\                 \        off               세그먼트 GPS 정보 반환 않음
=============  =========  =================  ========================================================

+-------------+---------+-----------------+--------------------------------------------------------+
| Params      | Type    | Value           | Description                                            |
+=============+=========+=================+========================================================+
| rttiField   | String  | speed           | Current measured speed field only                      |
+             +         +-----------------+--------------------------------------------------------+
|             |         | limit           | Speed limit field only                                 |
+             +         +-----------------+--------------------------------------------------------+
|             |         | travleTime      | Travel time (pass through the segment) field only      |
+             +         +-----------------+--------------------------------------------------------+
|             |         | freeFlow        | Reference free flow field only                         |
+             +         +-----------------+--------------------------------------------------------+
|             |         | all (default)   | Return all rtti fields                                 |
+-------------+---------+-----------------+--------------------------------------------------------+
| frc         | Integer | {FRC level}     | FRC matched fields only (comma delimited list of frc)  |
+             +         +-----------------+--------------------------------------------------------+
|             |         | all (default)   | Return all fields regardless of FRC level              |
+-------------+---------+-----------------+--------------------------------------------------------+
| start-time  | Datetime| time            | Return data from this time. Three types of responses   |
|             |         |                 | *Future : predicted data with `duration`, `interval`   |
|             |         |                 | *Past : historical data with `duration`, `interval`    |
|             |         |                 | *default : present                                     |
+-------------+---------+-----------------+--------------------------------------------------------+
| duration    | Integer | 5 to 60         | The duration to return data with the `interval`        |
|             |         | (multiple of 5) | The start-time plus the duration cannot excced 1 hr    |
|             |         |                 | from the current time (default: 0)                     |
+-------------+---------+-----------------+--------------------------------------------------------+
| interval    | Integer | minutes         | The period to report data as a multiple of 5 (<60)     |
+-------------+---------+-----------------+--------------------------------------------------------+
| lane        | String  | on (default)    | Enable lane level traffic (if possible)                |
+             +         +-----------------+--------------------------------------------------------+
|             |         | off             | Disable                                                |
+-------------+---------+-----------------+--------------------------------------------------------+
| lr          | Integer | openlr          | openLR codes only                                      |
+             +         +-----------------+--------------------------------------------------------+
|             |         | agorac          | AGORA-C codes only                                     |
+             +         +-----------------+--------------------------------------------------------+
|             |         | all (default)   | Return all lr fields.                                  |
+-------------+---------+-----------------+--------------------------------------------------------+
| coordinates | String  | on (default)    | Enable GPS pair of start/end node of the segment       |
+             +         +-----------------+--------------------------------------------------------+
|             |         | off             | Disable                                                |
+-------------+---------+-----------------+--------------------------------------------------------+

Response Parameters
..........................

.. note:: 응답은 하나 이상의 segment 로 구성 되며 JSON array 형태로 구성 됩니다.

+-----------------------+---------+------------------------------------------------------------+
| Property              | Type    | Description                                                |
+=======================+=========+============================================================+
| segmentId             | String  | ID of the segment                                          |
+-----------------------+---------+------------------------------------------------------------+
| roadCate              | String  | FRC level of the segement                                  |
+-----------------------+---------+------------------------------------------------------------+
| speed                 | Integer | Current speed of the segment                               |
+-----------------------+---------+------------------------------------------------------------+
| limit                 | Integer | Speed limit of the segment                                 |
+-----------------------+---------+------------------------------------------------------------+
| freeflow              | Integer | Reference free flow speed of the segment                   |
+-----------------------+---------+------------------------------------------------------------+
| traveltime            | String  | Time(sec) to pass through the segment                      |
+-----------------------+---------+------------------------------------------------------------+
| openlr                | String  | openLR location referencing code (encoded)                 |
+-----------------------+---------+------------------------------------------------------------+
| agorac                | String  | AGORA-C location referencing code (encoded)                |
+-----------------------+---------+------------------------------------------------------------+
| confidence-level      | String  | Confidence level of prediction process (only forecast)     |
+-----------------------+---------+------------------------------------------------------------+
| lane                  | Array   | Lane level traffic information object                      |
+-----------------------+---------+------------------------------------------------------------+
| -- laneNumber         | String  | Number of lane (inner lane < outerlane)                    |
+-----------------------+---------+------------------------------------------------------------+
| -- laneSpeed          | String  | Current speed of the specified lane of the segemnt         |
+-----------------------+---------+------------------------------------------------------------+
| timestamp             | Datetime| Timestamp when the traffic infromation was created         |
+-----------------------+---------+------------------------------------------------------------+

Request/Response Example
..........................
**Request Example**

+------------+-------------------------------------------------------------------------------------+
| **GET**    | `{host-ip}/ruut/v1/segments?filter_type=circle&center=37.397619,%20127.112465`      |
|            | `&radius=10&frc=1&rttiField=all&regionId=0&lr=all&lane=on`                          |
+------------+-------------------------------------------------------------------------------------+

**Response Example**

.. code-block:: json

    {
      "segments": [{
        "segmentId": "1020174101",
        "roadCate": 1,
        "speed": "84",
        "limit": "80",
        "freeFlow": "80",
        "travelTime": "58",
        "openLR": "C1pdVxqjGwktFgCN+34JEQ==",
        "agoraC": "",
        "lane": [
            {
                "laneNumber": "",
                "laneSpeed": ""
            }
        ],
        "timeStamp": "2019-10-23 15:04:00"
      }]
    }

Incident
''''''''''''''''''''''''''
=====  =====
col 1  col 2
=====  =====
1      Second column of row 1.
2      Second column of row 2.
       Second line of paragraph.
3      - Second column of row 3.

       - Second item in bullet
         list (row 3, column 2).
\      Row 4; column 1 will be empty.
=====  =====

RUUT TPEG
--------------------------
TPEG2
''''''''''''''''''''''''''

Auxiliary
--------------------------
History
''''''''''''''''''''''''''
